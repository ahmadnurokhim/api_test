<!DOCTYPE html>
<html>
<head>
    <title>Temperature and Humidity Dashboard</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Coin Price History</h1>
        <div class="row">
            <div class="col-md-6">
                <canvas id="coin1Chart" width="400" height="200"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="coin2Chart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"></script>


    <script>
    const socket = io.connect('https://' + document.domain + ':' + location.port);

    const maxDataPoints = 100; // Set the maximum number of data points

    const coin1Chart = new Chart(document.getElementById('coin1Chart').getContext('2d'), {
        type: 'line',
        data: {
            labels: [], // Initialize with empty labels
            datasets: [{
                label: 'Coin 1 (USD)',
                data: [],
                borderColor: 'red',
                fill: false
            }]
        },
        options: {
            scales: {
                x: { display: false }
            }
        }
    });

    const coin2Chart = new Chart(document.getElementById('coin2Chart').getContext('2d'), {
        type: 'line',
        data: {
            labels: [], // Initialize with empty labels
            datasets: [{
                label: 'Coin 2 (USD)',
                data: [],
                borderColor: 'blue',
                fill: false
            }]
        },
        options: {
            scales: {
                x: { display: false }
            }
        }
    });

    // Populate initial data points when the page is loaded
    socket.on('connect', function() {
        socket.emit('initial_data_request');
    });

    // Listen for initial data points from the server
    socket.on('initial_data', function(initialData) {
        initialData.forEach(function(dataPoint) {
            coin1Chart.data.labels.push(dataPoint.timestamp);
            coin1Chart.data.datasets[0].data.push(dataPoint.temperature);
            coin2Chart.data.labels.push(dataPoint.timestamp);
            coin2Chart.data.datasets[0].data.push(dataPoint.humidity);
        });

        coin1Chart.update();
        coin2Chart.update();
    });

    // Update the charts with new data points
    socket.on('update_data', function(data) {
        if (coin1Chart.data.labels.length >= maxDataPoints) {
            coin1Chart.data.labels.shift();
            coin1Chart.data.datasets[0].data.shift();
        }

        coin1Chart.data.labels.push(data.timestamp);
        coin1Chart.data.datasets[0].data.push(data.temperature);
        coin1Chart.update();

        if (coin2Chart.data.labels.length >= maxDataPoints) {
            coin2Chart.data.labels.shift();
            coin2Chart.data.datasets[0].data.shift();
        }

        coin2Chart.data.labels.push(data.timestamp);
        coin2Chart.data.datasets[0].data.push(data.humidity);
        coin2Chart.update();
    });
    </script>
</body>
</html>
